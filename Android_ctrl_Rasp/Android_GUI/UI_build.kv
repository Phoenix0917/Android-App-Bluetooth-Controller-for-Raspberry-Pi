#: import FadeTransition kivy.uix.screenmanager.FadeTransition
#: import SlideTransition kivy.uix.screenmanager.SlideTransition
#: import utils kivy.utils
#: import Joystick kivy.garden.joystick.Joystick

WindowManager: # root rule (can be any widget)
    transition: FadeTransition()
    CalibrationWindow: # class inside window manager
    UserWindow: # class inside window manager
    BluetoothWindow: # class inside window manager

<UserWindow>:
    name: "userWindow"

    FloatLayout:
        size: root.width, root.height

        Image:
            source: 'Images_Used/background.jpg'
            allow_stretch: True
            keep_ratio: False

        Label:
            id: status_indicator
            text: "Unconnected"
            font_size: self.width/8
            size_hint: 0.15, 0.075
            pos_hint: {'x': 0.01, 'top': 0.99}
            color: '#b5f7e6'
            canvas.before:
                Color:
                    rgba: utils.get_color_from_hex('#266352')
                Rectangle:
                    size: self.size
                    pos: self.pos

        Button:
            id: KillPi_ButtonObj
            pos_hint: {'right': 0.99, 'top': 0.99}
            background_normal: ''
            background_color: '#266352'
            font_size: 10
            size_hint: .125, .125
            disabled: True
            on_press:
                self.parent.parent.kill_pi_power()
            
            Image:
                source: 'Images_Used/power.png'
                center_x: self.parent.center_x
                center_y: self.parent.center_y
                width: self.parent.width * 0.9
                height: self.parent.height * 0.9
                keep_ratio: False

        Button:
            pos_hint: {'right': 0.84, 'top': 0.99}
            background_normal: ''
            background_color: '#266352'
            font_size: 10
            size_hint: .125, .125
            on_press:
                root.manager.current = "bluetooth"  
            
            Image:
                source: 'Images_Used/BT_Before.png'
                center_x: self.parent.center_x
                center_y: self.parent.center_y
                width: self.parent.width
                height: self.parent.height
                keep_ratio: False

        Button:
            id: go_to_dev
            text: "Cal screen"
            pos_hint: {'right': 0.69, 'top': 0.99}
            background_normal: ''
            background_color: '#266352'
            font_size: self.width / 8
            size_hint: .125, .125
            on_press:
                root.manager.current = "calibration" 


        Button:
            id: OpenClaw_ButtonObj
            text: "Open Claw"
            pos_hint: {'right': 0.99, 'y': 0.2}
            font_size: self.width / 8
            background_normal: ''
            background_color: '#266352'
            size_hint: .125, .125
            always_release: True
            on_press:
                root.control_claw('open')
            on_release:
                root.control_claw('stop') 

        Button:
            id: CloseClaw_ButtonObj
            text: "Close Claw"
            pos_hint: {'right': 0.99, 'y': 0.05}
            font_size: self.width / 8
            background_normal: ''
            background_color: '#266352'
            size_hint: .125, .125
            always_release: True
            on_press:
                root.control_claw('close')
            on_release:
                root.control_claw('stop') 

        Button:
            id: RaiseArm_ButtonObj
            text: "Raise Claw"
            pos_hint: {'right': 0.85, 'y': 0.2}
            font_size: self.width / 8
            background_normal: ''
            background_color: '#266352'
            size_hint: .125, .125
            always_release: True
            on_press:
                root.control_arm('raise')
            on_release:
                root.control_arm('stop')
           

        Button:
            id: LowerArm_ButtonObj
            text: "Lower Claw"
            pos_hint: {'right': 0.85, 'y': 0.05}
            font_size: self.width / 8
            background_normal: ''
            background_color: '#266352'
            size_hint: .125, .125
            always_release: True
            on_press:
                root.control_arm('lower')
            on_release:
                root.control_arm('stop')
            

        Slider:
            id: pwm_multiplier
            min: 0.2
            max: 1
            step: 0.2
            value: 0.2
            orientation: "vertical"
            pos_hint: {'x': 0.3, 'y': .05}
            size_hint: .1, .55 
            cursor_size: self.width/2 , self.width/2
            on_value: root.adjust_motor_voltage(*args)

        BoxLayout:
            size_hint_x: 0.5
            size_hint_y: 0.5
            pos_hint: {'x': -.1, 'y': .05}
            Joystick:
                id: Control_JoystickObj
                sticky: False
                outer_size: 0.7
                inner_size: 0.7
                pad_size:   0.5
                outer_line_width: 0.025
                inner_line_width: 0.015
                pad_line_width:   0.025
                outer_background_color: (0.75, 0.75, 0.75, 1)
                outer_line_color:       (0.25, 0.25, 0.25, 1)
                inner_background_color: (0.75, 0.75, 0.75, 1)
                inner_line_color:       (0.7,  0.7,  0.7,  1)
                pad_background_color:   (0.4,  0.4,  0.4,  1)
                pad_line_color:         (0.35, 0.35, 0.35, 1)


        Switch:
            active: True   
            pos_hint: {'x': .05, 'y': .6}
            size_hint: .1, .1
            #on_active: root.switch_callback()

            canvas:
                Color:
                    rgb: 1, 0, 0, 1
                Rectangle:
                    size: sp(41.5), sp(20)
                    pos: self.center_x - sp(40.0), self.center_y - sp(10)
                Color:
                    rgb: 0, 0, 1, 1
                Rectangle:
                    size: sp(41.0), sp(20)
                    pos: self.center_x, self.center_y - sp(10)
            Label:
                color: 1, 1, 1, 1
                text: 'DRV'
                bold: True
                font_size: self.width/8
                pos: self.parent.center_x - sp(70), self.parent.center_y - sp(50)                
            Label:
                color: 0, 1, 0, 1
                text: 'REV'
                bold: True
                font_size: self.width/8
                pos: self.parent.center_x - sp(30), self.parent.center_y - sp(50)

        Switch:
            active: True   
            pos_hint: {'x': .25, 'y': .6}
            size_hint: .1, .1
            #on_active: root.switch_callback()

            canvas:
                Color:
                    rgb: 1, 0, 0, 1
                Rectangle:
                    size: sp(41.5), sp(20)
                    pos: self.center_x - sp(40.0), self.center_y - sp(10)
                Color:
                    rgb: 0, 0, 1, 1
                Rectangle:
                    size: sp(41.0), sp(20)
                    pos: self.center_x, self.center_y - sp(10)
            Label:
                color: 1, 1, 1, 1
                text: 'JS'
                bold: True
                font_size: self.width/8
                pos: self.parent.center_x - sp(70), self.parent.center_y - sp(50)                
            Label:
                color: 0, 1, 0, 1
                text: 'TILT'
                bold: True
                font_size: self.width/8
                pos: self.parent.center_x - sp(30), self.parent.center_y - sp(50)


    

<CalibrationWindow>: # class rule
    name: "calibration"

    FloatLayout:
        size: root.width, root.height

        Image:
            source: 'Images_Used/background.jpg'
            allow_stretch: True
            keep_ratio: False
            
        Button:
            pos_hint: {'x': 0.01, 'top': 0.90}
            background_normal: ''
            background_color: '#266352'
            font_size: 10
            size_hint: .125, .125
            on_press:
                root.manager.current = "bluetooth"  
            
            Image:
                source: 'Images_Used/BT_Before.png'
                center_x: self.parent.center_x
                center_y: self.parent.center_y
                width: self.parent.width
                height: self.parent.height
                keep_ratio: False

        Label:
            id: status_indicator
            text: "Unconnected"
            font_size: self.width/8
            size_hint: 0.15, 0.075
            pos_hint: {'x': 0.01, 'top': 0.99}
            color: '#b5f7e6'
            canvas.before:
                Color:
                    rgba: utils.get_color_from_hex('#266352')
                Rectangle:
                    size: self.size
                    pos: self.pos

        Button:
            id: KillPi_ButtonObj
            pos_hint: {'right': 0.99, 'top': 0.99}
            background_normal: ''
            background_color: '#266352'
            font_size: 10
            size_hint: .125, .125
            disabled: True
            on_press:
                self.parent.parent.kill_pi_power()
            
            Image:
                source: 'Images_Used/power.png'
                center_x: self.parent.center_x
                center_y: self.parent.center_y
                width: self.parent.width * 0.9
                height: self.parent.height * 0.9
                keep_ratio: False

        Button:
            id: go_to_user
            text: "User Screen"
            pos_hint: {'x': 0.01, 'top': 0.76}
            background_normal: ''
            background_color: '#266352'
            font_size: self.width / 8
            size_hint: .125, .125
            on_press:
                root.manager.current = "userWindow" 


        ModifiedSlider:
            id: left_motor_control
            min: -100
            max: 100
            step: 1
            value: ((self.max - self.min) / 2) + self.min
            orientation: "vertical"
            pos_hint: {'x': 0.25, 'y': .1}
            size_hint: .1, .8 
            cursor_size: self.width / 1.5 , self.width / 1.5
            on_value: root.slide_it(*args)

        Label:
            text: "Left Motor Value " + str(left_motor_control.value) + "\n" + "Right Motor Value " + str(right_motor_control.value)

        ModifiedSlider:
            id: right_motor_control
            min: -100
            max: 100
            step: 1
            value: ((self.max - self.min) / 2) + self.min
            orientation: "vertical"
            pos_hint: {'right': 0.75, 'y': .1}
            size_hint: .1, .8 
            cursor_size: self.width / 1.5 , self.width / 1.5
            on_value: root.slide_it(*args)

<BluetoothWindow>: # class rule
    name: "bluetooth"

    Image:
        source: 'Images_Used/background.jpg'
        allow_stretch: True
        keep_ratio: False

    GridLayout:
        cols: 2
        
        FloatLayout:
            size: root.width, root.height

            Label:
                text: "Bluetooth Connections"
                size_hint: 1, .1
                pos_hint: {'x': 0, 'top': 0.90}
                font_size: self.width/15

            Label:
                id: PageStatus_LabelObj
                text: "Ready"
                font_size: self.width/8
                size_hint: 0.3, 0.075
                pos_hint: {'x': 0.01, 'top': 0.99}
                color: '#b5f7e6'
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#266352')
                    Rectangle:
                        size: self.size
                        pos: self.pos
            
            Button:
                id: ScanDevice_ButtonObj
                text: "Display Known\nSevices"
                halign: 'center'
                font_size: self.width/16
                on_press: self.parent.parent.parent.scan_paired()
                size_hint: 0.7, 0.15
                pos_hint: {'x': 0.15, 'top': 0.75}
                background_normal: ''
                background_color: '#266352'

            GridLayout:
                cols: 2
                size_hint: 0.9, 0.3
                pos_hint: {'x': 0.05, 'top': 0.55}

                Button:
                    text: "replace with\n device dropdown"
                    font_size: self.width/10

                Label:
                    text: "Don't see\nyour service?\n\nRe-pair within\nAndroid OS"
                    font_size: self.width/10


            Button:
                text: "Go Back"
                font_size: self.width/ 20
                on_release: root.manager.current = "calibration"
                background_normal: ''
                background_color: '#266352'
                size_hint: 0.8, 0.1
                pos_hint: {'x': 0.1, 'top': 0.20}


            Image:
                source: 'Images_Used/BNT_Logo.png'
                pos_hint: {'x': 0.01, 'y': 0.01}
                size_hint: 0.175, .075
                keep_ratio: True
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#010623')
                    Rectangle:
                        size: self.size
                        pos: self.pos

        
        FloatLayout:

            GridLayout:
                cols: 3
                size_hint: 0.95, 0.1
                pos_hint: {'x': 0, 'top': 0.95}

                GridLayout: 
                    rows: 2

                    Label:
                        text: "Results"
                        font_size: self.width/5

                    Label:
                        id: NumResults_LabelObj
                        text: "(3 per page)"
                        font_size: self.width/8

                Button:
                    text: "+1 elem"
                    on_press: root.increment_elem()
                    font_size: self.width/7

                Button:
                    text: "-1 elem"
                    on_press: root.decrement_elem()
                    font_size: self.width/7


            ScrollView:
                do_scroll_x: False
                do_scroll_y: True
                id: ScanResults_ScrollViewObj
                size_hint: 0.95, 0.77
                pos_hint: {'x': 0, 'top': 0.82}
                canvas.before:
                    Color:
                        rgba: (utils.get_color_from_hex('#266352'))
                    Rectangle:
                        size: self.size
                        pos: self.pos

                GridLayout:
                    width: self.parent.width
                    id: grid1
                    size_hint_x: 1
                    size_hint_y: None
                    cols: 1
                    row_default_height: self.parent.height / 3 
                    row_force_default: True
